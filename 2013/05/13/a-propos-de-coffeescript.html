<!DOCTYPE html>
<html lang="fr_BE">
    <head>
        <meta charset="utf-8" />
        
        <title>À propos de CoffeeScript... | blog.leny.me</title>
        <meta name="author" content="Leny">
        
        <meta name="description" content="Il y a quelques années, quand je faisais du javascript, je codais un peu n’importe comment : l’important, c’est que ça marche.
On faisait un peu atten" />
        
        
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <meta property="og:title" content="À propos de CoffeeScript..." />
        <meta property="og:site_name" content="blog.leny.me" />

        
        <meta property="og:image" content="undefined" />
        

        <link rel="shortcut icon" href="/favicon.png" />
        <link rel="alternate" href="/atom.xml" title="blog.leny.me" type="application/atom+xml" />
        <link rel="stylesheet" href="/styles/styles.css" media="screen" type="text/css" />
        <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
    </head>


    <body>
        <div id="wrapper">
            <div id="toplinks">
                <a href="http://leny.me" rel="external">
                    leny.me
                </a>
                <a href="http://blog.leny.me">
                    blog.leny.me
                </a>
            </div>

            <header>
                <h1>
    <a href="/">
        blog.leny.me
    </a>
</h1>

            </header>

            <section id="content">
                
    

<article>
    <header class="coffee">
        <h1>
            À propos de CoffeeScript...
        </h1>
    </header>

    <div class="content">
        <p>Il y a quelques années, quand je faisais du javascript, je codais un peu n’importe comment : l’important, c’est que ça marche.</p>
<p>On faisait un peu attention aux performances, mais dans l’ensemble, on s’en cognait un peu.</p>
<p>Mais depuis quelques années (et un <em>passage</em> d’un peu plus d’un an dans une équipe qui m’a appris XP, le développement agile et tout le bordel afférent), je ne veille plus seulement à coder <em>propre</em>, je veille à coder <strong>beau</strong>.</p>
<p>Ce qui nous en vient à parler de CoffeeScript.</p>
<p>Un peu après sa sortie, quand les devs ont commencé à parler de CoffeeScript, j’ai essayé et je n’ai pas aimé. Je le reconnais, j’ai essayé un peu vite, et mon avis était <em>biaisé</em> par des billets d’humeur assez partiaux et contre CoffeeScript, blâmant des problèmes de performance, de code généré, etc…</p>
<p>Et moi, comme un con, j’ai tout pris pour argent comptant.</p>
<p>Le temps passa, et ça nous ramène à quelques mois, début 2013.<br>J’avais pris un abonnement d’un mois au fantastique <a href="http://codeschool.com" target="_blank" rel="external">CodeSchool</a>, pour réviser Node.js, que j’avais appris dans l’urgence des mois auparavant (c’est toujours une bonne chose de lire ou voir un tutoriel sur un langage qu’on connait - on apprend souvent des trucs utiles, ou de nouvelles façons d’appréhender le langage).</p>
<p>Bref, une fois les cours de Node.js terminés, et pour rentabiliser mon investissement, j’ai fait tous les cours du site, y compris celui sur CoffeeScript, mon point de vue encore un peu embrumé par mes expériences des années précédentes.</p>
<p>Et dès les 5 premières minutes du premier chapitre, je fus horrifié : en CoffeeScript, me disait le formateur, on ne déclare pas les variables !<br>Euh, quoi ?<br>Mais ça va pas, la tête ? Je me tue à essayer d’apprendre à mes étudiants à ne pas oublier de le faire, et en CoffeeScript, on ne le fait pas ?!</p>
<p>Et là, j’ai fais l’idiot : j’ai coupé le tutoriel.<br>Puis j’ai coupé mon ordinateur, toutes les lumières, et je me suis assis en serrant mes genoux et en me balancant doucement d’avant en arrière.<br>Enfin, pas tout à fait, mais vous comprennez l’idée.</p>
<p>C’était une réaction idiote, pasque quelques jours plus tard, poussé par je ne sais quelle force invisible, je relance ce tutoriel et vais jusqu’aux exercices, et exécute le premier, l’estomac au bord des lèvres d’avoir à utiliser des variables non-déclarées (on en viendrait presqu’à me prendre pour un fachiste).</p>
<p>Et dans la petite fenêtre de résultat, je vois, à ma grande (et positive) surprise, que si en CoffeeScript, on ne déclare pas les variables, c’est pasqu’à la compilation, <strong>CoffeeScript les déclare pour vous</strong>.<br>C’était beau, ma vie était de retour jolie, je n’avais plus qu’à nettoyer les larmes que j’avais mis un peu partout les jours d’avant.</p>
<p>Mais il y avait toujours un truc qui me chiffonait : c’était bien beau, tout ça, et écrire en CoffeeScript était éffectivement plus rapide et plus joli qu’en JS, mais quid des performances ?<br>Pasque le coup de la surcouche de langage toute jolie mais qui génère du code tout pourris, celle-la aussi, on me l’avait déjà faite, j’étais méfiant.</p>
<p>Et donc, j’ai fait des tests.<br>Et dans quasiment tous les cas, quand on compare du code CoffeeScript compilé en js, et le même code en js <em>vanille</em>, les performances sont similaires. Et quand il y a une différence elle est rarement de plus de 10%, ce qui est, dans la plupart des cas, acceptable.</p>
<p>Un p’tit exemple ?</p>
<p>Prennons le script suivant, en js <em>vanille</em>, qui récupère des images dans un document, et remplis un tableau avec la valeur de leur attribut src.<br>Ce script fonctionne et est déjà bien optimisé.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> aImageSrc = [],</div><div class="line">    oAllImg = window.document.querySelectorAll( <span class="string">'img'</span> ),</div><div class="line">    i = -<span class="number">1</span>,</div><div class="line">    oElement;</div><div class="line"><span class="keyword">for</span>( ; oElement = oAllImg[ ++i ]; ) {</div><div class="line">    aImageSrc.push( oElement.getAttribute( <span class="string">'src'</span> ) );</div><div class="line">}</div></pre></td></tr></table></figure>

<p>En <strong>CoffeeScript</strong>, pour faire la même chose, on le fait ainsi : </p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">aImageSrc = ( oElement.getAttribute <span class="string">'src'</span> <span class="keyword">for</span> oElement <span class="keyword">in</span> <span class="built_in">window</span>.<span class="built_in">document</span>.querySelectorAll( <span class="string">'img'</span> ) )</div></pre></td></tr></table></figure>

<p>Ouais, une ligne. C’est <em>beau</em>™.<br>Compilé en javascript, ça donne ceci : </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">aImageSrc = (<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span></div><div class="line">    <span class="keyword">var</span> _i, _len, _ref, _results;</div><div class="line">    _ref = window.document.querySelectorAll(<span class="string">'img'</span>);</div><div class="line">    _results = [];</div><div class="line">    <span class="keyword">for</span> (_i = <span class="number">0</span>, _len = _ref.length; _i &lt; _len; _i++) {</div><div class="line">        oElement = _ref[_i];</div><div class="line">        _results.push(oElement.getAttribute(<span class="string">'src'</span>));</div><div class="line">    }</div><div class="line">    <span class="keyword">return</span> _results;</div><div class="line">})();</div></pre></td></tr></table></figure>

<p>Faut dire ce qui est, niveau bonnes pratiques, c’est déjà tout bon.</p>
<p>Ensuite, les tests.<br>Pour celà, rien de mieux qu’<a href="http://jsperf.com/vanillajs-vs-coffeescript-loop" target="_blank" rel="external">un petit JSPerf</a>.<br>Comme vous pouvez le constater, dans la plupart des cas, les performances sont au coude-à-coude, quand ce n’est pas carrément la version compilée par CoffeeScript qui est meilleure.</p>
<p>CQFD.</p>
<p>Pour ma part et après ces tests, j’ai laissé sa chance à CoffeeScript et depuis, je ne code quasi plus qu’avec lui.<br>Je songe même à en donner un petit cours d’introduction à mes étudiant de l’année prochaine, en fin de cursus, quand ils seront un peu plus à l’aise avec du javascript avancé.</p>

    </div>

    <footer>
        <span class="author">
            leny
        </span>
        <time datetime="2013-05-12T22:00:00.000Z">
            13 mai 2013
        </time>
    </footer>
</article>

<div class="comments">
    <p>
        Il n'y a pas de module de <strong>commentaires</strong> sur ce blog, principalement pour éviter à devoir gérer avec les spams, la pub, les insultes, ...
    </p>
    <p>
        Toutefois, si vous avez quelque chose à dire/corriger/modifier, ou simplement exprimer votre opinion sur un post, n'hésitez pas à me contacter sur Twitter (<a href="//twitter.com/leny_be" rel="external">@leny_be</a>).
    </p>
</div>


            </section>

            <footer>
                <p>
    <span id="copyleft">&#61948;</span><a href="http://leny.me" rel="external">leny.me</a> - <a href="http://creativecommons.org/licenses/by-sa/4.0/deed.fr" rel="external">Contenu sous licence CC by-sa</a>
</p>
<p>
    Powered by <a href="http://zespia.tw/hexo/" rel="external">hexo</a>.<br />
    Theme by <a href="http://leny.me" rel="external">leny</a>, inspired by <a href="http://arturkim.com/" rel="external">Artur Kim</a>.
</p>

            </footer>
        </div>
        <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-39717980-3', 'leny.me');
  ga('send', 'pageview');
</script>

    </body>
</html>
